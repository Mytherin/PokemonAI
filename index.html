
<canvas id="pokemoncanvas" style="width:800px;height:450px;margin-left:auto;margin-right:auto;">

</canvas>

<script>
var canvas = document.getElementById("pokemoncanvas");
var c = canvas.getContext("2d");

var HEALTHBAR_HEIGHT = 6;
var HEALTHBAR_WIDTH = 80;
var HEALTHBAR_FONTSIZE = "12";

battle_width = 800;
battle_height = 450;



var backgroundImage = new Image();
backgroundImage.src = 'images/background.png';

var pokemons = ["bulbasaur", "charmander", "squirtle", "pikachu", "jigglypuff", "meowth", "mankey", "pidgey", "ekans", "geodude", "sandshrew", "drowzee", "gastly", "butterfree", "dratini"]
var types = {}
types["water"] = "63B8FF"
types["electric"] = "#CDCD00"
types["fire"] = "#B22222"
types["grass"] = "#228B22"
types["ghost"] = "#5D478B"
types["psychic"] = "#CD6090"
types["normal"] = "#6C7B8B"
types["fighting"] = "#8B4513"
var pokemon_images = {}

var active_pokemon_p1 = {};
var active_pokemon_p2 = {};

active_pokemon_p1.name = "bulbasaur";
active_pokemon_p1.health = 1;
active_pokemon_p1.display_health = 1;
active_pokemon_p1.frame = 0;

active_pokemon_p2.name = "pikachu";
active_pokemon_p2.health = 1;
active_pokemon_p2.display_health = 1;
active_pokemon_p2.frame = 0;

var HEALTH_ANIMATION_SPEED = 0.01;

String.prototype.toProperCase = function () {
    return this.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
};

for (var i = 0; i < pokemons.length; i++) {
	var pkmn = pokemons[i];
	pokemon_images[pkmn] = {};
	var image = new Image();
	image.src = 'images/' + pkmn + '-front.png'
	pokemon_images[pkmn].front = image;
	var image = new Image();
	image.src = 'images/' + pkmn + '-back.png'
	pokemon_images[pkmn].back = image;
}

function drawBackground(c, backgroundImage, x, y, width, height) {
	c.drawImage(backgroundImage, x, y, width, height);
}

function drawHealthBar(c, x, y, percentage, name, type) {
	c.font = "bold " + HEALTHBAR_FONTSIZE + "px Calibri";

	var size = c.measureText("HP");
	c.fillStyle = "#222222"
	c.fillText("HP", x - size.width - 5, y + HEALTHBAR_FONTSIZE / 4);

	// first draw the background of the health bar
	var grd = c.createLinearGradient(x, y - HEALTHBAR_HEIGHT / 2, x, y + HEALTHBAR_HEIGHT / 2);
	grd.addColorStop(0.0, "#B2B2B2");
	grd.addColorStop(0.5, "#FFFFFF");
	grd.addColorStop(1.0, "#B2B2B2");

	c.fillStyle = grd;
	c.fillRect(x, y - HEALTHBAR_HEIGHT / 2, HEALTHBAR_WIDTH, HEALTHBAR_HEIGHT);

	// now draw the foreground
	var grd = c.createLinearGradient(x, y - HEALTHBAR_HEIGHT / 2, x, y + HEALTHBAR_HEIGHT / 2);
	if (percentage > 0.5) {
		c1 = "#1C472B";
		c2 = "#2BC741";
	} else if (percentage > 0.25) {
		c1 = "#8F3F00";
		c2 = "#FF7F00";
	} else {
		c1 = "#811111";
		c2 = "#B22222";
	}
	grd.addColorStop(0.0, c1);
	grd.addColorStop(0.5, c2);
	grd.addColorStop(1.0, c1);

	c.fillStyle = grd;
	c.fillRect(x, y - HEALTHBAR_HEIGHT / 2, HEALTHBAR_WIDTH * percentage, HEALTHBAR_HEIGHT);
	c.strokeStyle = "#000000";
	c.strokeRect(x, y - HEALTHBAR_HEIGHT / 2, HEALTHBAR_WIDTH, HEALTHBAR_HEIGHT);

	var size = c.measureText(name)
	c.fillStyle = "#000000"
	c.fillText(name, x + (HEALTHBAR_WIDTH - size.width) / 2, y - HEALTHBAR_FONTSIZE / 2);

	c.font = "bold " + (HEALTHBAR_FONTSIZE - 2) + "px Calibri";

	c.fillStyle = types[type];
	c.fillRect(x, y + HEALTHBAR_HEIGHT, HEALTHBAR_WIDTH / 2, 10);

	c.strokeStyle = "#000000"
	c.strokeRect(x, y + HEALTHBAR_HEIGHT, HEALTHBAR_WIDTH / 2, 10);

	var size = c.measureText(type.toProperCase());
	c.fillStyle = "#FFFFFF"
	c.fillText(type.toProperCase(), x + (HEALTHBAR_WIDTH / 2 - size.width) / 2, y + HEALTHBAR_HEIGHT + 3 + (HEALTHBAR_FONTSIZE - 2) / 2)

}

function drawPokemon(c, pkmn, isFront) {
	var image;
	var name = pkmn.name.toProperCase();
	var health = pkmn.display_health;
	var type = "electric"
	if (isFront) {
		image = pokemon_images[name.toLowerCase()].front;
	} else {
		image = pokemon_images[name.toLowerCase()].back;
	}
	if (isFront) {
		x = canvas.width - 80 - image.height / 2;
		y = 10 + image.height / 2;
	} else {
		x = 20 + image.height / 2;
		y = canvas.height - 60 - image.height / 2;
	}
	current_frame = Math.round(pkmn.frame);
	total_frames = Math.round(image.width / image.height);
	c.drawImage(image,
		current_frame * image.height,
		0,
		image.height,
		image.height,
		x,
		y,
		image.height,
		image.height);
	// move to the next frame
	if (pkmn.frame + 1 >= total_frames) {
		pkmn.frame = 0;
	} else {
		pkmn.frame += 0.3;
	}

	if (isFront) {
		drawHealthBar(c, 50, 30, health, name, type);
	} else {
		drawHealthBar(c, canvas.width - 40 - HEALTHBAR_WIDTH, canvas.height - 40, health, name, type);
	}
}

function update_health(pkmn) {
	if (Math.abs(pkmn.display_health - pkmn.health) <= HEALTH_ANIMATION_SPEED) {
		pkmn.display_health = pkmn.health;
	} else if (pkmn.display_health < pkmn.health) {
		pkmn.display_health += HEALTH_ANIMATION_SPEED;
	} else if (pkmn.display_health > pkmn.health) {
		pkmn.display_health -= HEALTH_ANIMATION_SPEED;
	}
}

function update() {
	update_health(active_pokemon_p1);
	update_health(active_pokemon_p2);
}

function render() {
	drawBackground(c, backgroundImage, 0, 0, canvas.width, canvas.height);
	drawPokemon(c, active_pokemon_p2, false)
	drawPokemon(c, active_pokemon_p1, true)
}

function loop(timestamp) {
	var t = timestamp - lastRender

	update();
	render();

	lastRender = timestamp
	window.requestAnimationFrame(loop)
}

document.onkeydown = function(evt) {
    evt = evt || window.event;

	if (evt.keyCode == 40) {
		// down arrow
	} else if (evt.keyCode == 37) {
		// left arrow
	}  else if (evt.keyCode == 39) {
		// right arrow
	}  else if (evt.keyCode == 38) {
		// up arrow
	}
};

var lastRender = 0
window.requestAnimationFrame(loop);

</script>